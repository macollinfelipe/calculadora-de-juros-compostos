<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Juros Compostos</title>
  <style>
    body {font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9;}
    .container {max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    h1 {text-align: center;}
    label {display: block; margin-top: 10px;}
    input {width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;}
    button {margin-top: 15px; padding: 10px; width: 100%; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer;}
    button:hover {background: #0056b3;}
    .menu {text-align: right; margin-bottom: 10px;}
    .menu a {text-decoration: none; background: #28a745; color: #fff; padding: 8px 12px; border-radius: 4px;}
    #resultado {margin-top: 20px; font-weight: bold;}
  </style>
</head>
<body>
  <div class="container">
    <div class="menu">
      <a href="https://www.youtube.com/@macollinfelipe" target="_blank">Canal Macollin Felipe</a>
    </div>
    <h1>Calculadora de Juros Compostos</h1>
    <label for="valorInicial">Valor Inicial (R$)</label>
    <input id="valorInicial" type="text" value="1000">

    <label for="aporte">Aporte Mensal (R$)</label>
    <input id="aporte" type="text" value="200">

    <label for="taxa">Taxa de juros (%)</label>
    <input id="taxa" type="text" value="8">

    <label for="periodo">Período (meses)</label>
    <input id="periodo" type="number" value="12">

    <button id="btnCalcular">Calcular</button>
    <div id="resultado"></div>
  </div>

  <script>
    // Robust parsing and formatting for Brazilian numbers
    function parseBrazilian(str) {
      if (str === undefined || str === null) return 0;
      str = String(str).trim();
      if (str === '') return 0;
      // remove spaces
      str = str.replace(/\s/g, '');
      // If there are both dots and commas, assume dots are thousands separators and comma is decimal
      if ((str.match(/\./g) || []).length > 0 && (str.match(/,/g) || []).length > 0) {
        str = str.replace(/\./g, '');
        str = str.replace(/,/g, '.');
      } else if ((str.match(/,/g) || []).length > 0 && (str.match(/\./g) || []).length === 0) {
        // only comma present -> decimal comma
        str = str.replace(/,/g, '.');
      } else {
        // only dots or none -> remove dots (treat as thousand sep)
        str = str.replace(/\./g, '');
      }
      const n = parseFloat(str);
      return isNaN(n) ? 0 : n;
    }

    function formatCurrencyBR(value) {
      return new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(value);
    }

    function formatPercentBR(value) {
      return new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(value);
    }

    // Calculation
    function calcular() {
      const valorInicial = parseBrazilian(document.getElementById('valorInicial').value);
      const aporte = parseBrazilian(document.getElementById('aporte').value);
      const taxaRaw = parseBrazilian(document.getElementById('taxa').value);
      const taxa = taxaRaw / 100; // user types e.g. 8 for 8%
      const periodo = parseInt(document.getElementById('periodo').value) || 0;

      let montante = valorInicial;
      for (let i = 0; i < periodo; i++) {
        // apply interest on current balance, then add aporte (aportes at end of period)
        montante = montante * (1 + taxa) + aporte;
      }

      // <- CORREÇÃO AQUI: usar template literal com crases para montar a string corretamente
      document.getElementById('resultado').innerText = `Valor final: R$ ${formatCurrencyBR(montante)}`;
    }

    // Attach formatting handlers without blocking input
    function attachFormat(el, isPercent = false) {
      if (!el) return;

      // allow only numbers, comma and dot while typing
      el.addEventListener('keydown', function (e) {
        const allowed = ['Backspace', 'Tab', 'Delete', 'ArrowLeft', 'ArrowRight', 'Home', 'End'];
        if (allowed.includes(e.key) || e.ctrlKey || e.metaKey) return;
        if (/^[0-9.,]$/.test(e.key)) return;
        e.preventDefault();
      });

      el.addEventListener('paste', function (e) {
        const paste = (e.clipboardData || window.clipboardData).getData('text') || '';
        if (!/^[0-9.,\s]+$/.test(paste)) {
          e.preventDefault();
        }
      });

      // on focus: show raw numeric string using comma as decimal separator (user-friendly)
      el.addEventListener('focus', function () {
        const v = parseBrazilian(el.value);
        el.value = (v === 0 && String(el.value).trim() === '') ? '' : String(v).replace('.', ',');
        setTimeout(() => { try { el.selectionStart = el.selectionEnd = el.value.length; } catch (e) {} }, 0);
      });

      // on blur: format nicely
      el.addEventListener('blur', function () {
        const v = parseBrazilian(el.value);
        el.value = isPercent ? formatPercentBR(v) : formatCurrencyBR(v);
      });

      // ensure initial formatting
      const initial = parseBrazilian(el.value);
      el.value = isPercent ? formatPercentBR(initial) : formatCurrencyBR(initial);
    }

    attachFormat(document.getElementById('valorInicial'));
    attachFormat(document.getElementById('aporte'));
    attachFormat(document.getElementById('taxa'), true);

    document.getElementById('btnCalcular').addEventListener('click', calcular);
  </script>
</body>
</html>
